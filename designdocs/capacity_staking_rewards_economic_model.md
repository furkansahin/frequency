# Capacity Staking Rewards Economic Model

This document outlines the economic model to be used for:
1. determining the token value of the Reward Pool for a given Era
2. how to calculate rewards for an individual staker
3. when rewards are calculated
4. when rewards are paid out
5. where these calculations are performed

## Context and Scope:
The Frequency Transaction Payment system uses Capacity to pay for certain transactions on chain.  Accounts that wish to pay with Capacity must:
1. Have an [MSA](https://github.com/LibertyDSNP/frequency/blob/main/designdocs/accounts.md)
2. Be a [Provider](https://github.com/LibertyDSNP/frequency/blob/main/designdocs/provider_registration.md) (see also [Provider Permissions and Grants](https://github.com/LibertyDSNP/frequency/blob/main/designdocs/provider_permissions.md))
3. Stake a minimum amount of FRQCY token to receive [Capacity](https://github.com/LibertyDSNP/frequency/blob/main/designdocs/capacity.md).

There is also a business case for allowing any token holder to lock up its tokens in exchange for a reward - known as _staking_ - while also targeting a Provider to receive some Capacity.


## Problem Statement:
A system consisting only of providers and coinless users who delegate to providers will tend toward centralization.
To build a self-sustaining Frequency network where control is decentralized, a variety of economic solutions are needed.  One of these is the ability to stake FRQCY token in return for something; this creates an incentive for participation and involvement with the chain fundamentals and governance.

How is that so?  Capacity is how Frequency intends Providers to pay for the vast majority of their on-chain messages. If Providers receive some capacity when end users stake, then they lose capacity if those end users unstake. If a Provider's Capacity from Reward staking is significant, this gives Reward Stakers some power over Providers. If a Provider is utilizing all or nearly all their Capacity almost every Epoch -- which they should be if trying to be economical --  then even a small percentage of lost Capacity will literally cost them to replace it.

We imagine that FRQCY could be airdropped by various entities to encourage onboarding, including Providers themselves. Providers may offer airdrops in exchange for such things as bringing in new users, or sharing links on other platforms, then encourage their users to stake their FRQCY for rewards.  Rewards could be exchanged for in-dApp benefits such as premium features, special emoji, avatar customization, and the like.  Rewards Staking could also unlock features.

## Assumptions
* The exact formula for calculating rewards is determined in advance and used in the implementation of this design.
* Rewards are not prorated; they are calculated based on the staking account balance at the start of an Era.
* Like other blockchains, we round away "dust", values that are _10<sup>-tbd</sup>_ FRQCY or less.

## To be decided:
* Is Reward Pool token total itself fixed (with input values determined by governance), or is it the Reward _rate_ that is fixed?
* What are the inputs to the economic model(s) for Capacity generation and Rewards?
* How does the capacity generated by Maximized Capacity Staking differ from that generated by Rewards Capacity Staking? Maximized is more than Rewards, but by how much?
* Are rewards compounded?

## Economic Model
By "economic model" we mean the formulae used to manage staking rewards to achieve the goals of decentralization, economic stabiilty, and sustainability.

Inputs in the economic model to consider could include:
* Proportion of accounts are staking to total accounts
* Mean number MSAs per Provider, or the mean compared to median.
* Proportion of token staked to free balance held by non-Treasury accounts
* The Capacity-per-Epoch use rate, perhaps averaged over N epochs
* The length of an Epoch in blocks
* The length of an Era n blocks

These could be used to adjust the cost of capacity and the reward return percentage.

Example 1: We want a specific percentage of token accounts to stake in order to meet a certain decentralization goal, and we are below that amount.  We increase the reward rate to encourage token holders to stake, without adjusting the cost of capacity.

Example 2: Capacity is consistently under-utilized:  We could decrease the cost of Capacity without changing the reward rate to encourage all Providers to post more often.  We could also decrease the reward rate, which would cause some unstaking and reduce the available Capacity in the network.

Example 3: The median number of MSAs per provider is significantly lower than the mean, which could indicate a handful of Providers (or just one) are dominating Capacity use, which could mean a trend toward centralization.  We could decrease the cost of Capacity to encourage all Providers to post more often, and to encourage more new Providers.  We could also increase the reward rate to encourage more staking, which could also provide capacity to new Providers.

### Example possible calculations for rewards:
There are many possible calculations but here are some ideas about what factors could influence the rewards and how they could be incorporated, starting with very simple (and also very unlikely) to complicated (probably also not likely).

For a reward pool _RP_ or individual rewards _R_, Total Staked Token _t_, number of Stakers _s_, number of Providers _p_, total Capacity generated by Maximized staking c<sub>m</sub>, total Capacity generated by Rewards staking c<sub>r</sub>

| Description| Governance constants | Example Equation|
|------------|----------------------|-----------------|
| _R_ is fixed at some percent _M_ of _t_| M | $R = {Mt}$ |
| _RP_ is linear and rewards decentralization of Stakers and Providers | N,M,P | $RP = {Nt + Ms + Pp \over 100}$ |
| _RP_ is some polynomial of order _i,j_ | N,M,P | $RP = { Nt + Ms^i + Pp^j }$ |

Lastly, Rewards/Capacity could be based on a more complex equation, perhaps which depends on the size of the targeted Provider.

We could implement diminishing returns on rewards and/or capacity.  This would reward smaller Providers and stakers who target them much more than "whales". The coefficient could be adjusted based on total number of accounts, number of Providers, total token staked, etc, depending on where we want the "hump" to be for most Providers and stakers; we would probably want it significantly above their average Capacity level so that purchasing more Capacity is still approximately a linear return, whereas much larger participants ("whales") would have to spend more money to get the same increase in Capacity.

Such a system could diminish the "nothing succeeds like success" effect, however, if the effect is too strong, whales could be driven off the platform since growth is too expensive.  It would need to be carefully tailored so new Providers could grow their presence relatively easily.  This is much different from the norm of resource acquisition, where "bulk discounts" dominate.

Since there is no difference to the chain for what Provider is posting what message, a "bulk discount" for posting Capacity messages doesn't apply.

## Goals
1. Specify verbally or in pseudo-code how to do the 5 things listed at the top of this document

## Non-Goals
1. Do not specify implementation details
2. Do not specify final naming
## Proposal:

## Benefits and Risks:
### Benefit: stabler message costs
Staking locks up token.  Locked token may not be immediately withdrawn; this dampens some level of speculation-driven volatility as well as that driven by opportunistic Capacity purchases.

### Benefit: improved engagement and expanded user base
A Provider may, for example, airdrop tokens to users who meet certain criteria, such as referrals or sharing links on other platforms.  Users with token may choose Reward staking to generate Capacity for their Provider and also get token rewards.

### Benefit: improved economic sustainability
A staking reward system can improve /onboard/uptake/usage/...

### Risk: staking system incentivizes gaming
If the staking system is too complicated, it can breed exploits and encourage gaming the systme.
If the staking system does not make it worthwhile to stake for rewards, the goal of decentralization is not achieved, and/or it can encourage gaming the system

# Risk: staking system penalizes whale Providers
If the system is unreliable, unstable or not economical enough for large Providers -- _particularly_ compared to alternatives -- the goal of decentralization may be achieved in some sense, but at the expense of widespread adoption.

### Risk: Faulty reward calculations:
* Maximized Stake for capacity is not cheaper per txn than pay-as-you-go with token
* Maximized Stake for capacity pays better than staking to be a collator

### Arguments in favor of storage values for reward rate and capacity price
* transparency:  it's more transparent than a Config, which could be changed only by an upgrade. This is because changes to Config values can be easily overlooked if they are buried in a large upgrade. Making them be subject to governance approval puts the change on chain, making it more subject to review.
* stabler: reward rates and capacity prices would have an automatic upper limit to how frequently they could change.

### Arguments against
* risk to network sustainability:  it's possible that proposed changes which would actually be necessary to Frequency's economic stability and sustainability may be rejected by token voters. This is mitigated particularly at the start of Frequency's operation given the token distribution, and also with the voting power and permissions of Frequency and Technical Councils.

#### Mitigation:
Adjust reward amounts. This is why the reward amounts need to be adjustable.

[//]: # (the reasons why this solution was chosen, and the risks this solution poses.)
[//]: # (For example, the solution may be very simple, but there could performance bottlenecks above a certain threshold.)
[//]: # (Another: the solution is well known and widely used, but it's not a perfect fit and requires complicated changes in one area.)

## Alternatives and Rationale:

### Why can't Frequency use Substrate `staking` pallet?
The staking pallet is for rewarding node validators, and rewards must be claimed within `HISTORY_DEPTH` blocks before the record of them is purged.  Reward payouts for a given validator can be called by any account and the rewards go o the validator and are shared with its nominators. The staking pallet keeps track of what rewards have been claimed within that `HISTORY_DEPTH` number of blocks.

Since Capacity Rewards staking is for FRQCY token account holders, we should not require those holders to have to call an extrinsic regularly to receive rewards.

Secondly, we must plan for the number of Providers to dwarf the number of validators on the Polkadot Relay chain.  The Polkadot relay chain currently has validators in the hundreds.  Calculating the payouts for hundreds of items in RocksDB storage is a very different prospect than calculating rewards for thousands of Providers and potentially tens of millions (or more) of Rewards stakers.  It may be that this type of optimization is deferred, however, this design must not make it difficult to optimize.

[//]: # (discuss alternatives that were considered, and why they were rejected.)
[//]: # (Note when there are absolute requirements that the solution does not and can't meet. One example might be, it's a proprietary solution but we need something open source.)

## Sources:

[//]: # (sources of information that led to this design.)
